# Deployment Guide: Distributed Architecture

Your **Frontend (Vercel)** and **Worker (VPS)** utilize a **Decoupled Architecture**. They **do not** communicate directly with each other. Instead, they interact asynchronously using your **Supabase Database** as the bridge.

## How it Works
1.  **Frontend (Vercel)**:
    - User creates a broadcast.
    - Frontend inserts data into the `Broadcast` table in Supabase.
    - Frontend polls the `Instance` table to show status/QR code.
2.  **Worker (VPS)**:
    - Polls the `Broadcast` table for pending jobs.
    - Sends messages via WhatsApp.
    - Updates the `Instance` table with connection status and QR codes.

## Setup Instructions

### 1. Database (Supabase)
Ensure both your Vercel project and VPS have the **exact same** `DATABASE_URL` and `DIRECT_URL`. This is the shared "brain" of the system.

---

### 2. Frontend (Deploy to Vercel)
1.  Push your code to GitHub/GitLab.
2.  Import the project into Vercel.
3.  In Vercel **Settings > Environment Variables**, add:
    -   `DATABASE_URL`: (Your pooled request connection string)
    -   `DIRECT_URL`: (Your direct connection string)
4.  Deploy.

---

### 3. Worker (Deploy to VPS)
Your worker needs to run permanently on a server (Ubuntu/DigitalOcean/AWS, etc).

**Steps on your VPS:**
1.  **Install Node.js 20+**.
2.  **Clone your repository** (or just upload the `worker` folder).
3.  Navigate to the worker directory:
    ```bash
    cd uWA/worker
    ```
4.  Install dependencies:
    ```bash
    npm install
    ```
5.  **Create .env file** with the same database credentials:
    ```bash
    nano .env
    # Paste DATABASE_URL and DIRECT_URL here
    ```
6.  **Build the worker**:
    ```bash
    npm run build
    ```
7.  **Run with PM2** (Process Manager) so it stays alive:
    ```bash
    npm install -g pm2
    pm2 start dist/index.js --name "uwa-worker"
    pm2 save
    pm2 startup
    ```

## Verification
-   Open your **Vercel URL** (Frontend).
-   Go to the **Connection** page.
-   The QR Code generated by the **VPS** will appear on your **Vercel Frontend** automatically because they are both reading/writing to the same database tables.
